!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.spel2js=t():e.spel2js=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{SpelExpressionEvaluator:()=>le,StandardContext:()=>fe});var n={LITERAL_INT:1,LITERAL_LONG:2,LITERAL_HEXINT:3,LITERAL_HEXLONG:4,LITERAL_STRING:5,LITERAL_REAL:6,LITERAL_REAL_FLOAT:7,LPAREN:"(",RPAREN:")",COMMA:",",IDENTIFIER:0,COLON:":",HASH:"#",RSQUARE:"]",LSQUARE:"[",LCURLY:"{",RCURLY:"}",DOT:".",PLUS:"+",STAR:"*",MINUS:"-",SELECT_FIRST:"^[",SELECT_LAST:"$[",QMARK:"?",PROJECT:"![",DIV:"/",GE:">=",GT:">",LE:"<=",LT:"<",EQ:"==",NE:"!=",MOD:"%",NOT:"!",ASSIGN:"=",INSTANCEOF:"instanceof",MATCHES:"matches",BETWEEN:"between",SELECT:"?[",POWER:"^",ELVIS:"?:",SAFE_NAVI:"?.",BEAN_REF:"@",SYMBOLIC_OR:"||",SYMBOLIC_AND:"&&",INC:"++",DEC:"--"};function r(e){this.type=e,this.tokenChars=n[e],this._hasPayload="string"!=typeof n[e],"number"==typeof n[e]&&(this._ordinal=n[e])}for(var o in n)n.hasOwnProperty(o)&&(r[o]=new r(o));function a(e,t,n,r){this.kind=e,this.startPos=n,this.endPos=r,t&&(this.data=t)}r.prototype.toString=function(){return this.type+(0!==this.tokenChars.length?"("+this.tokenChars+")":"")},r.prototype.getLength=function(){return this.tokenChars.length},r.prototype.hasPayload=function(){return this._hasPayload},r.prototype.valueOf=function(e){for(var t in n)if(n.hasOwnProperty(t)&&n[t]===e)return r[t]},r.prototype.ordinal=function(){return this._ordinal},a.prototype.getKind=function(){return this.kind},a.prototype.toString=function(){var e="[";return e+=this.kind.toString(),this.kind.hasPayload()&&(e+=":"+this.data),(e+="]")+"("+this.startPos+","+this.endPos+")"},a.prototype.isIdentifier=function(){return this.kind===r.IDENTIFIER},a.prototype.isNumericRelationalOperator=function(){return this.kind===r.GT||this.kind===r.GE||this.kind===r.LT||this.kind===r.LE||this.kind===r.EQ||this.kind===r.NE},a.prototype.stringValue=function(){return this.data},a.prototype.asInstanceOfToken=function(){return new a(r.INSTANCEOF,this.startPos,this.endPos)},a.prototype.asMatchesToken=function(){return new a(r.MATCHES,this.startPos,this.endPos)},a.prototype.asBetweenToken=function(){return new a(r.BETWEEN,this.startPos,this.endPos)},a.prototype.getStartPosition=function(){return this.startPos},a.prototype.getEndPosition=function(){return this.endPos};var i=["DIV","EQ","GE","GT","LE","LT","MOD","NE","NOT"],u=[];!function(){var e;for(e="0".charCodeAt(0);e<="9".charCodeAt(0);e+=1)u[e]|=3;for(e="A".charCodeAt(0);e<="F".charCodeAt(0);e+=1)u[e]|=2;for(e="a".charCodeAt(0);e<="f".charCodeAt(0);e+=1)u[e]|=2;for(e="A".charCodeAt(0);e<="Z".charCodeAt(0);e+=1)u[e]|=4;for(e="a".charCodeAt(0);e<="z".charCodeAt(0);e+=1)u[e]|=4}();var s=function(e){var t=e,n=e+"\0",o=n.length,s=0,c=[];function l(){for(var e,o=s,i=!1;!i;)if("'"===(e=n[s+=1])&&("'"===n[s+1]?s+=1:i=!0),0===e.charCodeAt(0))throw{name:"SpelParseException",message:"Non-terminating quoted string in expression ("+t+") at position "+s};s+=1,c.push(new a(r.LITERAL_STRING,v(o,s),o,s))}function f(){for(var e,o=s,i=!1;!i;)if('"'===(e=n[s+=1])&&('"'===n[s+1]?s+=1:i=!0),0===e.charCodeAt(0))throw{name:"SpelParseException",message:"Non-terminating double-quoted string in expression ("+t+") at position "+s};s+=1,c.push(new a(r.LITERAL_STRING,v(o,s),o,s))}function p(e){var r,o,a,i=!1,u=s,c=n[s+1];if(!e||"x"!==c&&"X"!==c){do{s+=1}while(I(n[s]));if("."===(c=n[s])){i=!0,r=s;do{s+=1}while(I(n[s]));if(s===r+1)return void h(v(u,s=r),!1,u,s)}if(o=s,R("L","l")){if(i)throw{name:"SpelParseException",message:"Real cannot be long in expression ("+t+") at position "+s};h(v(u,o),!0,u,o),s+=1}else if(function(e){return"e"===e||"E"===e}(n[s])){i=!0,function(e){return"+"===e||"-"===e}(n[s+=1])&&(s+=1);do{s+=1}while(I(n[s]));a=!1,L(n[s])?(a=!0,o=s+=1):S(n[s])&&(o=s+=1),d(v(u,s),a,u,s)}else a=!1,L(c=n[s])?(i=!0,a=!0,o=s+=1):S(c)&&(i=!0,o=s+=1),i?d(v(u,o),a,u,o):h(v(u,o),!1,u,o)}else{s+=1;do{s+=1}while(y(n[s]));R("L","l")?(E(v(u+2,s),!0,u,s),s+=1):E(v(u+2,s),!1,u,s)}}function g(){var e,t,o,u=s;do{s+=1}while(T(o=n[s])||I(o)||"_"===o||"$"===o);e=v(u,s),(s-u==2||s-u==3)&&(t=e.toUpperCase(),i.indexOf(t)>=0)?function(e,t,n){c.push(new a(e,n,t,t+e.getLength()))}(r.valueOf(t),u,e):c.push(new a(r.IDENTIFIER,e.replace("\0",""),u,s))}function h(e,t,n,o){t?c.push(new a(r.LITERAL_LONG,e,n,o)):c.push(new a(r.LITERAL_INT,e,n,o))}function E(e,n,o,i){if(0===e.length)throw n?{name:"SpelParseException",message:"Not a long in expression ("+t+") at position "+s}:{name:"SpelParseException",message:"Not an int in expression ("+t+") at position "+s};n?c.push(new a(r.LITERAL_HEXLONG,e,o,i)):c.push(new a(r.LITERAL_HEXINT,e,o,i))}function d(e,t,n,o){t?c.push(new a(r.LITERAL_REAL_FLOAT,e,n,o)):c.push(new a(r.LITERAL_REAL,e,n,o))}function v(e,t){return n.substring(e,t)}function m(e){return 2===e.tokenChars.length&&n[s]===e.tokenChars[0]&&n[s+1]===e.tokenChars[1]}function C(e){c.push(new a(e,null,s,s+1)),s+=1}function A(e){c.push(new a(e,null,s,s+2)),s+=2}function R(e,t){var r=n[s];return r===e||r===t}function L(e){return"f"===e||"F"===e}function S(e){return"d"===e||"D"===e}function I(e){return!(e.charCodeAt(0)>255||!(1&u[e.charCodeAt(0)]))}function T(e){return!(e.charCodeAt(0)>255||!(4&u[e.charCodeAt(0)]))}function y(e){return!(e.charCodeAt(0)>255||!(2&u[e.charCodeAt(0)]))}return function(){for(var e;s<o;)if(T(e=n[s]))g();else switch(e){case"+":m(r.INC)?A(r.INC):C(r.PLUS);break;case"_":g();break;case"-":m(r.DEC)?A(r.DEC):C(r.MINUS);break;case":":C(r.COLON);break;case".":C(r.DOT);break;case",":C(r.COMMA);break;case"*":C(r.STAR);break;case"/":C(r.DIV);break;case"%":C(r.MOD);break;case"(":C(r.LPAREN);break;case")":C(r.RPAREN);break;case"[":C(r.LSQUARE);break;case"#":C(r.HASH);break;case"]":C(r.RSQUARE);break;case"{":C(r.LCURLY);break;case"}":C(r.RCURLY);break;case"@":C(r.BEAN_REF);break;case"^":m(r.SELECT_FIRST)?A(r.SELECT_FIRST):C(r.POWER);break;case"!":m(r.NE)?A(r.NE):m(r.PROJECT)?A(r.PROJECT):C(r.NOT);break;case"=":m(r.EQ)?A(r.EQ):C(r.ASSIGN);break;case"&":if(!m(r.SYMBOLIC_AND))throw{name:"SpelParseException",message:"Missing character '&' in expression ("+t+") at position "+s};A(r.SYMBOLIC_AND);break;case"|":if(!m(r.SYMBOLIC_OR))throw{name:"SpelParseException",message:"Missing character '|' in expression ("+t+") at position "+s};A(r.SYMBOLIC_OR);break;case"?":m(r.SELECT)?A(r.SELECT):m(r.ELVIS)?A(r.ELVIS):m(r.SAFE_NAVI)?A(r.SAFE_NAVI):C(r.QMARK);break;case"$":m(r.SELECT_LAST)?A(r.SELECT_LAST):g();break;case">":m(r.GE)?A(r.GE):C(r.GT);break;case"<":m(r.LE)?A(r.LE):C(r.LT);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":p("0"===e);break;case" ":case"\t":case"\r":case"\n":case"\0":s+=1;break;case"'":l();break;case'"':f();break;case"\\":throw{name:"SpelParseException",message:"Unexpected escape character in expression ("+t+") at position "+s};default:throw{name:"SpelParseException",message:"Cannot handle character '"+e+"' in expression ("+t+") at position "+s}}}(),c},c={create:function(e,t){var n,r={},o=e||"Abstract",a=[],i=null;if(r._type=o,r.getType=function(){return o},r.setType=function(e){o=e},r.getChildren=function(){return a},r.addChild=function(e){if(e){if(!e.setParent)throw{name:"Error",message:"Trying to add a child which is not a node: "+JSON.stringify(e)};e.setParent(r),a.push(e)}},r.getParent=function(){return i},r.setParent=function(e){i=e},r.getContext=function(e){return n||e.activeContext.peek()},r.setContext=function(e){n=e},r.getStartPosition=function(){return t>>16},r.getEndPosition=function(){return 65535&t},r.getValue=function(){throw{name:"MethodNotImplementedException",message:"SpelNode#getValue() must be overridden."}},r.toString=function(){var e="Kind: "+r.getType();e+=", Children: [";for(var t=0,n=r.getChildren().length;t<n;t+=1)e+="{"+r.getChildren()[t]+"}, ";return e+"]"},0===t)throw{name:"Error",message:"Position cannot be 0"};for(var u=arguments.length,s=new Array(u>2?u-2:0),c=2;c<u;c++)s[c-2]=arguments[c];return s&&s.forEach((function(e){r.addChild(e)})),r}},l=function(e,t){var n=c.create("boolean",t);return n.getValue=function(){return e},n.setValue=function(t){return e=t},n},f=function(e,t){var n=c.create("number",t);return n.getValue=function(){return e},n.setValue=function(t){return e=t},n},p=function(e,t){var n=c.create("string",t);return e=function(e){return("'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1])&&(e=e.substring(1,e.length-1)),e.replace(/''/g,"'").replace(/""/g,'"')}(e),n.getValue=function(){return e},n.setValue=function(t){return e=t},n},g=function(e,t){var n=c.create("null",t);return n.getValue=function(){return null},n};function h(e){this.elements=e||[]}h.prototype.push=function(e){return this.elements.push(e),e},h.prototype.pop=function(){return this.elements.pop()},h.prototype.peek=function(){return this.elements[this.elements.length-1]},h.prototype.empty=function(){return this.elements.length>0},h.prototype.search=function(e){return this.elements.length-this.elements.indexOf(e)};var E=function(e,t,n){var r=c.create("function",t);return r.getRaw=function(){return{functionName:e,args:n}},r.getValue=function(t){var r=t.locals||{},o=t.rootContext,a=[];if(n.forEach((function(e){var n=t.activeContext;t.activeContext=new h,t.activeContext.push(t.rootContext),a.push(e.getValue(t)),t.activeContext=n})),r[e])return r[e].apply(o,a);throw{name:"FunctionDoesNotExistException",message:"Function '"+e+"' does not exist."}},r},d=function(e,t,n,r){var o=c.create("method",n);return o.getRaw=function(){return{methodName:t,args:r}},o.getValue=function(n){var o,a=n.activeContext.peek(),i=[];if(!a)throw{name:"ContextDoesNotExistException",message:"Attempting to look up property '"+t+"' for an undefined context."};function u(n){if(null==n){if(e)return null;throw{name:"NullPointerException",message:"Method "+t+" does not exist."}}return n}if(r.forEach((function(e){var t=n.activeContext;n.activeContext=new h,n.activeContext.push(n.rootContext),i.push(e.getValue(n)),n.activeContext=t})),"get"===t.substr(0,3)&&!a[t])return u(a[t.charAt(3).toLowerCase()+t.substring(4)]);if("set"===t.substr(0,3)&&!a[t])return a[t.charAt(3).toLowerCase()+t.substring(4)]=i[0];if(Array.isArray(a)){if("size"===t)return a.length;if("contains"===t)return a.includes(i[0])}return(o=u(a[t]))?o.apply(a,i):null},o},v=function(e,t,n){var r=c.create("property",n);return r.getRaw=function(){return t},r.getValue=function(n){var r=n.activeContext.peek();if(!r){if(e)return null;throw{name:"ContextDoesNotExistException",message:"Attempting to look up property '"+t+"' for an undefined context."}}if(void 0===r[t]||null===r[t]){if(e)return null;if("size"===t&&Array.isArray(r))return r.length;throw{name:"NullPointerException",message:"Property '"+t+"' does not exist."}}return r[t]},r.setValue=function(e,n){var r=n.activeContext.peek();if(!r)throw{name:"ContextDoesNotExistException",message:"Attempting to assign property '"+t+"' for an undefined context."};return r[t]=e},r.getName=function(){return t},r},m=function(e,t){var n=c.create("variable",t);return n.getRaw=function(){return e},n.getValue=function(t){var n=t.activeContext.peek(),r=t.locals;if(!n)throw{name:"ContextDoesNotExistException",message:"Attempting to look up variable '"+e+"' for an undefined context."};return"this"===e?n:"root"===e?t.rootContext:r[e]},n.setValue=function(t,n){return n.locals[e]=t},n},C=function(e,t){var n=c.create.apply(null,["compound",e].concat(t));function r(e){var t,r=n.getChildren().length;for(t=0;t<r;t+=1)"indexer"===n.getChildren()[t].getType()?e.activeContext.push(e.activeContext.peek()[n.getChildren()[t].getValue(e)]):e.activeContext.push(n.getChildren()[t].getValue(e));return function(){for(t=0;t<r;t+=1)e.activeContext.pop()}}return n.getValue=function(e){var t;if(!e.activeContext.peek())throw{name:"ContextDoesNotExistException",message:"Attempting to evaluate compound expression with an undefined context."};var n=r(e);return t=e.activeContext.peek(),n(),t},n.setValue=function(e,t){var o=r(t),a=n.getChildren().length;return t.activeContext.pop(),e=n.getChildren()[a-1].setValue(e,t),t.activeContext.push(null),o(),e},n},A=function(e,t){var n=c.create.apply(null,["indexer",e].concat(t));return n.getValue=function(e){var t,r,o=e.activeContext,a=n.getChildren().length;if(e.activeContext=new h,e.activeContext.push(e.rootContext),!e.activeContext.peek())throw{name:"ContextDoesNotExistException",message:"Attempting to evaluate compound expression with an undefined context."};for(t=0;t<a;t+=1)e.activeContext.push(n.getChildren()[t].getValue(e));for(r=e.activeContext.peek(),t=0;t<a;t+=1)e.activeContext.pop();return e.activeContext=o,r},n},R=function(e,t,n){var r=c.create("assign",e,t,n);return r.getValue=function(e){if(!e.activeContext.peek())throw{name:"ContextDoesNotExistException",message:"Attempting to assign property '"+t.getValue(e)+"' for an undefined context."};return t.setValue(n.getValue(e),e)},r},L=function(e,t,n){var r=c.create("op-eq",e,t,n);return r.getValue=function(e){return t.getValue(e)===n.getValue(e)},r},S=function(e,t,n){var r=c.create("op-ne",e,t,n);return r.getValue=function(e){return t.getValue(e)!==n.getValue(e)},r},I=function(e,t,n){var r=c.create("op-ge",e,t,n);return r.getValue=function(e){return t.getValue(e)>=n.getValue(e)},r},T=function(e,t,n){var r=c.create("op-gt",e,t,n);return r.getValue=function(e){return t.getValue(e)>n.getValue(e)},r},y=function(e,t,n){var r=c.create("op-le",e,t,n);return r.getValue=function(e){return t.getValue(e)<=n.getValue(e)},r},N=function(e,t,n){var r=c.create("op-lt",e,t,n);return r.getValue=function(e){return t.getValue(e)<n.getValue(e)},r},V=function(e,t,n){var r=c.create("op-plus",e,t,n);return r.getValue=function(e){return n?t.getValue(e)+n.getValue(e):+t.getValue(e)},r},x=function(e,t,n){var r=c.create("op-minus",e,t,n);return r.getValue=function(e){return n?t.getValue(e)-n.getValue(e):-t.getValue(e)},r},P=function(e,t,n){var r=c.create("op-multiply",e,t,n);return r.getValue=function(e){var r=t.getValue(e),o=n.getValue(e);if("number"==typeof r&&"number"==typeof o)return r*o;if("string"==typeof r&&"number"==typeof o){for(var a="",i=0;i<o;i+=1)a+=r;return a}return null},r},O=function(e,t,n){var r=c.create("op-divide",e,t,n);return r.getValue=function(e){return t.getValue(e)/n.getValue(e)},r},w=function(e,t,n){var r=c.create("op-modulus",e,t,n);return r.getValue=function(e){return t.getValue(e)%n.getValue(e)},r},b=function(e,t,n){var r=c.create("op-power",e,t,n);return r.getValue=function(e){return Math.pow(t.getValue(e),n.getValue(e))},r},_=function(e,t,n){var r=c.create("op-inc",e,n);return r.getValue=function(e){var r=n.getValue(e);return n.setValue(r+1,e),t?r:r+1},r},k=function(e,t,n){var r=c.create("op-dec",e,n);return r.getValue=function(e){var r=n.getValue(e);return n.setValue(r-1,e),t?r:r-1},r},M=function(e,t){var n=c.create("op-not",e,t);return n.getValue=function(e){return!t.getValue(e)},n},D=function(e,t,n){var r=c.create("op-and",e,t,n);return r.getValue=function(e){return!!t.getValue(e)&&!!n.getValue(e)},r},U=function(e,t,n){var r=c.create("op-or",e,t,n);return r.getValue=function(e){return!!t.getValue(e)||!!n.getValue(e)},r},F=function(e,t,n){var r=c.create("matches",e,t,n);return r.getValue=function(e){var r=t.getValue(e),o=n.getValue(e);try{return!!new RegExp(o).exec(r)}catch(e){throw{name:"EvaluationException",message:e.toString()}}},r},K=function(e,t,n,r){var o=c.create("ternary",e,t,n,r);return o.getValue=function(e){return t.getValue(e)?n.getValue(e):r.getValue(e)},o},G=function(e,t,n){var r=c.create("elvis",e,t,n);return r.getValue=function(e){return null!==t.getValue(e)?t.getValue(e):n.getValue(e)},r},Q=function(e,t){var n=c.create("list",e),r=[].concat(t||[]);return n.getRaw=function(){return r},n.getValue=function(e){return r.map((function(t){return t.getValue(e)}))},n},B=function(e,t){var n=c.create("map",e),r=[].concat(t||[]);return n.getValue=function(e){var t=!0,n=null,o={};return r.forEach((function(r){t?n="property"===r.getType()?r.getName():r.getValue(e):o[n]=r.getValue(e),t=!t})),o},n};function Y(e){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y(e)}function j(e,t,n){var r;return n.activeContext.push(e),r=t.getValue(n),n.activeContext.pop(),r}var H=function(e,t,n,r){var o=c.create("selection",n,r);return o.getValue=function(e){var n=e.activeContext.peek();if(n){if(Array.isArray(n))return function(e,t,n,r){var o=e.filter((function(e){return j(e,n,r)}));switch(t){case"ALL":return o;case"FIRST":return o[0]||null;case"LAST":return o.length?o[o.length-1]:null}}(n,t,r,e);if("object"===Y(n))return function(e,t,n,r){var o,a,i={},u=[],s={};for(a in e)e.hasOwnProperty(a)&&j(o={key:a,value:e[a]},n,r)&&u.push(o);switch(t){case"ALL":return u.forEach((function(e){i[e.key]=e.value})),i;case"FIRST":return u.length?(s[u[0].key]=u[0].value,s):null;case"LAST":return u.length?(s[u[u.length-1].key]=u[u.length-1].value,s):null}u.forEach((function(e){i[e.key]=e.value}))}(n,t,r,e)}return null},o},X="FIRST",$="LAST",q="ALL";function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function W(e,t,n){return e.map((function(e){var r;return n.activeContext.push(e),r=t.getValue(n),n.activeContext.pop(),r}))}var z=function(e,t,n){var r=c.create("projection",t,n);return r.getValue=function(e){var t,r=e.activeContext.peek(),o=[];if(Array.isArray(r))return W(r,n,e);if("object"===J(r)){for(t in r)r.hasOwnProperty(t)&&o.push(r[t]);return W(o,n,e)}return null},r},Z=function(e,t,n){var r=c.create("instanceof",e,t,n);return r.getValue=function(e){throw{name:"MethodNotImplementedException",message:"OpInstanceOf: Not implemented"}},r},ee=function(e,t,n){var r=c.create("between",e,t,n);return r.getValue=function(e){throw{name:"MethodNotImplementedException",message:"OpBetween: Not implemented"}},r},te=function(e,t,n){return(t=c.create("typeref",e,t)).getValue=function(e){throw{name:"MethodNotImplementedException",message:"TypeReference: Not implemented"}},t},ne=function(e,t){var n=c.create("beanref",e);return n.getValue=function(e){throw{name:"MethodNotImplementedException",message:"BeanReference: Not implemented"}},n},re=function(e,t){var n=c.create("identifier",t);return n.getRaw=function(){return e},n.getValue=function(e){throw{name:"MethodNotImplementedException",message:"Identifier: Not implemented"}},n};function oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var ae=function(e,t){var n,r=c.create.apply(c,["qualifiedidentifier",e].concat(function(e){if(Array.isArray(e))return oe(e)}(n=t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return oe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?oe(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()));return r.getRaw=function(){return t.map((function(e){return e.getRaw()}))},r.getValue=function(e){throw{name:"MethodNotImplementedException",message:"QualifiedIdentifier: Not implemented"}},r};function ie(e,t){if(e){if("string"==typeof e)return ue(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ue(e,t):void 0}}function ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function se(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var ce=function(e,t,n){var r,o=void 0!==n;o?r=t.length&&t[0]&&"number"===t[0].getType()?t[0].getValue():null:(n=t,t=void 0);var a,i=function(e){if(Array.isArray(e))return e}(a=n)||se(a)||ie(a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),u=(i[0],i.slice(1)),s=c.create.apply(c,["constructorref",e].concat(function(e){return function(e){if(Array.isArray(e))return ue(e)}(e)||se(e)||ie(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(n)));return s.getRaw=function(){return r},s.getValue=function(e){if(o&&u.length<=1){var t=[];return u.forEach((function(n){var r=e.activeContext;e.activeContext=new h,e.activeContext.push(e.rootContext),t.push(n.getValue(e)),e.activeContext=r})),1===u.length?t[0]:r?new Array(r):[]}throw{name:"MethodNotImplementedException",message:"ConstructorReference: Not implemented"}},s},le={};le.compile=function(e){var t=function(){var e,t,n,o,a=new RegExp("[\\p{L}\\p{N}_$]+"),i=[];function u(){var e=c();if(Te()){var t=Ne();if(t.getKind()===r.ASSIGN){null===e&&(e=g(we(t.startPos-1,t.endPos-1))),ye();var n=c();return R(Oe(t),e,n)}if(t.getKind()===r.ELVIS){null===e&&(e=g(we(t.startPos-1,t.endPos-2))),ye();var o=u();return null===o&&(o=g(we(t.startPos+1,t.endPos+1))),G(Oe(t),e,o)}if(t.getKind()===r.QMARK){null===e&&(e=g(we(t.startPos-1,t.endPos-1))),ye();var a=u();Ae(r.COLON);var i=u();return K(Oe(t),e,a,i)}}return e}function c(){for(var e=h();Ie("or")||Re(r.SYMBOLIC_OR);){var t=ye(),n=h();xe(t,e,n),e=U(Oe(t),e,n)}return e}function h(){for(var e=Y();Ie("and")||Re(r.SYMBOLIC_AND);){var t=ye(),n=Y();xe(t,e,n),e=D(Oe(t),e,n)}return e}function Y(){var e=j(),t=function(){var e=Ne();if(null===e)return null;if(e.isNumericRelationalOperator())return e;if(e.isIdentifier()){var t=e.stringValue();if("instanceof"===t.toLowerCase())return e.asInstanceOfToken();if("matches"===t.toLowerCase())return e.asMatchesToken();if("between"===t.toLowerCase())return e.asBetweenToken()}return null}();if(null!==t){var n=ye(),o=j();xe(n,e,o);var a=t.kind;if(t.isNumericRelationalOperator()){var i=Oe(n);return a===r.GT?T(i,e,o):a===r.LT?N(i,e,o):a===r.LE?y(i,e,o):a===r.GE?I(i,e,o):a===r.EQ?L(i,e,o):S(i,e,o)}return a===r.INSTANCEOF?Z(Oe(n),e,o):a===r.MATCHES?F(Oe(n),e,o):ee(Oe(n),e,o)}return e}function j(){for(var e=J();Se(r.PLUS,r.MINUS,r.INC);){var t=ye(),n=J();Pe(t,n),t.getKind()===r.PLUS?e=V(Oe(t),e,n):t.getKind()===r.MINUS&&(e=x(Oe(t),e,n))}return e}function J(){for(var e=W();Se(r.STAR,r.DIV,r.MOD);){var t=ye(),n=W();xe(t,e,n),e=t.getKind()===r.STAR?P(Oe(t),e,n):t.getKind()===r.DIV?O(Oe(t),e,n):w(Oe(t),e,n)}return e}function W(){var e,t=oe();if(Re(r.POWER)){e=ye();var n=oe();return Pe(e,n),b(Oe(e),t,n)}return null!==t&&Se(r.INC,r.DEC)?(e=ye()).getKind()===r.INC?_(Oe(e),!0,t):k(Oe(e),!0,t):t}function oe(){var e,t;return Se(r.PLUS,r.MINUS,r.NOT)?(e=ye(),t=oe(),e.getKind()===r.NOT?M(Oe(e),t):e.getKind()===r.PLUS?V(Oe(e),t):x(Oe(e),t)):Se(r.INC,r.DEC)?(e=ye(),t=oe(),e.getKind()===r.INC?_(Oe(e),!1,t):k(Oe(e),!1,t)):function(){var e=[],t=function(){var e=Ne();if(null===e)return!1;if(e.getKind()===r.LITERAL_INT||e.getKind()===r.LITERAL_LONG)me(f(parseInt(e.stringValue(),10),Oe(e)));else if(e.getKind()===r.LITERAL_REAL||e.getKind()===r.LITERAL_REAL_FLOAT)me(f(parseFloat(e.stringValue()),Oe(e)));else if(e.getKind()===r.LITERAL_HEXINT||e.getKind()===r.LITERAL_HEXLONG)me(f(parseInt(e.stringValue(),16),Oe(e)));else if(Ie("true"))me(l(!0,Oe(e)));else if(Ie("false"))me(l(!1,Oe(e)));else{if(e.getKind()!==r.LITERAL_STRING)return!1;me(p(e.stringValue(),Oe(e)))}return ye(),!0}()||function(){if(Re(r.LPAREN)){ye();var e=u();return Ae(r.RPAREN),me(e),!0}return!1}()||function(){if(Re(r.IDENTIFIER)){var e=Ne();if("T"!==e.stringValue())return!1;var t=ye();if(Re(r.RSQUARE))return me(v(t.stringValue(),Oe(t))),!0;Ae(r.LPAREN);for(var n=Ee(),o=0;Le(r.LSQUARE,!0);)Ae(r.RSQUARE),o++;return Ae(r.RPAREN),me(te(Oe(e),n,o)),!0}return!1}()||function(){if(Re(r.IDENTIFIER)){var e=Ne();return"null"===e.stringValue().toLowerCase()&&(ye(),me(g(Oe(e))),!0)}return!1}()||function(){if(Ie("new")){var e=ye();if(Re(r.RSQUARE))return me(v(e.stringValue(),Oe(e))),!0;var t=Ee(),n=[];if(n.push(t),Re(r.LSQUARE)){for(var o=[];Le(r.LSQUARE,!0);)Re(r.RSQUARE)?o.push(null):o.push(u()),Ae(r.RSQUARE);pe()&&n.push(Ce()),me(ce(Oe(e),o,n))}else a=n,Re(r.LPAREN)||Ve(Oe(Ne()),"MISSING_CONSTRUCTOR_ARGS"),le(a),Ae(r.RPAREN),me(ce(Oe(e),n));return!0}var a;return!1}()||ve(!1)||ue()||function(){if(Re(r.BEAN_REF)){var e=ye(),t=null,n=null;return Re(r.IDENTIFIER)?n=(t=Ae(r.IDENTIFIER)).data:Re(r.LITERAL_STRING)?n=(n=(t=Ae(r.LITERAL_STRING)).stringValue()).substring(1,n.length()-1):Ve(e.startPos,"INVALID_BEAN_REFERENCE"),me(ne(Oe(t),n)),!0}return!1}()||fe(!1)||he(!1)||ge()||pe()?Ce():null;for(e.push(t);ie();)e.push(Ce());return 1===e.length?e[0]:C(we(t.getStartPosition(),e[e.length-1].getEndPosition()),e)}()}function ie(){var e,t,n;return null!==(e=Se(r.DOT,r.SAFE_NAVI)?ve(n=(t=ye()).getKind()===r.SAFE_NAVI)||ue()||fe(n)||he(n)?Ce():(null===Ne()?Ve(t.startPos,"OOD"):Ve(t.startPos,"UNEXPECTED_DATA_AFTER_DOT",function(e){return e.getKind().hasPayload()?e.stringValue():e.getKind().toString().toLowerCase()}(Ne())),null):Re(r.LSQUARE)&&ge()?Ce():null)&&(me(e),!0)}function ue(){if(!Re(r.HASH))return!1;var e=ye(),t=Ae(r.IDENTIFIER),n=se();return null===n?(me(m(t.data,we(e.startPos,t.endPos))),!0):(me(E(t.data,we(e.startPos,t.endPos),n)),!0)}function se(){if(!Re(r.LPAREN))return null;var e=[];return le(e),Ae(r.RPAREN),e}function le(e){var t,n=Ne().startPos;do{ye();var o=Ne();null===o&&Ve(n,"RUN_OUT_OF_ARGUMENTS"),o.getKind()!==r.RPAREN&&e.push(u()),t=Ne()}while(null!==t&&t.kind===r.COMMA);null===t&&Ve(n,"RUN_OUT_OF_ARGUMENTS")}function fe(e){var t=Ne();if(!Le(r.PROJECT,!0))return!1;var n=u();return Ae(r.RSQUARE),me(z(e,Oe(t),n)),!0}function pe(){var e=Ne(),t=[];if(!Le(r.LCURLY,!0))return!1;var n=null,o=Ne();if(Le(r.RCURLY,!0))n=Q(we(e.startPos,o.endPos));else if(Le(r.COLON,!0))o=Ae(r.RCURLY),n=B(we(e.startPos,o.endPos));else{var a=u();if(Re(r.RCURLY))t.push(a),o=Ae(r.RCURLY),n=Q(we(e.startPos,o.endPos),t);else if(Le(r.COMMA,!0)){t.push(a);do{t.push(u())}while(Le(r.COMMA,!0));o=Ae(r.RCURLY),n=Q(Oe(e.startPos,o.endPos),t)}else if(Le(r.COLON,!0)){var i=[];for(i.push(a),i.push(u());Le(r.COMMA,!0);)i.push(u()),Ae(r.COLON),i.push(u());o=Ae(r.RCURLY),n=B(we(e.startPos,o.endPos),i)}else Ve(e.startPos,"OOD")}return me(n),!0}function ge(){var e=Ne();if(!Le(r.LSQUARE,!0))return!1;var t=u();return Ae(r.RSQUARE),me(A(Oe(e),t)),!0}function he(e){var t=Ne();if(!function(){if(!Te())return!1;var e=Ne();return e.getKind()===r.SELECT||e.getKind()===r.SELECT_FIRST||e.getKind()===r.SELECT_LAST}())return!1;ye();var n=u();return null===n&&Ve(Oe(t),"MISSING_SELECTION_EXPRESSION"),Ae(r.RSQUARE),t.getKind()===r.SELECT_FIRST?me(H(e,X,Oe(t),n)):t.getKind()===r.SELECT_LAST?me(H(e,$,Oe(t),n)):me(H(e,q,Oe(t),n)),!0}function Ee(){for(var t=[],n=Ne();de(n);)ye(),n.kind!==r.DOT&&t.push(re(n.stringValue(),Oe(n))),n=Ne();t.length||(null===n&&Ve(e.length(),"OOD"),Ve(n.startPos,"NOT_EXPECTED_TOKEN","qualified ID",n.getKind().toString().toLowerCase()));var o=we(t[0].getStartPosition(),t[t.length-1].getEndPosition());return ae(o,t)}function de(e){if(null===e||e.kind===r.LITERAL_STRING)return!1;if(e.kind===r.DOT||e.kind===r.IDENTIFIER)return!0;var t=e.stringValue();return t&&t.length&&a.test(t)}function ve(e){if(Re(r.IDENTIFIER)){var t=ye(),n=se();return null===n?(me(v(e,t.stringValue(),Oe(t))),!0):(me(d(e,t.stringValue(),Oe(t),n)),!0)}return!1}function me(e){i.push(e)}function Ce(){return i.pop()}function Ae(t){var n=ye();return null===n&&Ve(e.length,"OOD"),n.getKind()!==t&&Ve(n.startPos,"NOT_EXPECTED_TOKEN",t.toString().toLowerCase(),n.getKind().toString().toLowerCase()),n}function Re(e){return Le(e,!1)}function Le(e,t){if(!Te())return!1;var n=Ne();return n.getKind()===e?(t&&o++,!0):e===r.IDENTIFIER&&n.getKind().ordinal()>=r.DIV.ordinal()&&n.getKind().ordinal()<=r.NOT.ordinal()&&null!==n.data}function Se(){if(!Te())return!1;for(var e=Ne(),t=Array.prototype.slice.call(arguments),n=0,r=t.length;n<r;n+=1)if(e.getKind()===t[n])return!0;return!1}function Ie(e){if(!Te())return!1;var t=Ne();return t.getKind()===r.IDENTIFIER&&t.stringValue().toLowerCase()===e.toLowerCase()}function Te(){return o<t.length}function ye(){return o>=n?null:t[o++]}function Ne(){return o>=n?null:t[o]}function Ve(t,n,r,o){throw r&&(n+="\nExpected: "+r),o&&(n+="\nActual: "+o),{name:"InternalParseException",message:"Error occurred while attempting to parse expression '"+e+"' at position "+t+". Message: "+n}}function xe(e,t,n){!function(e,t){null===t&&Ve(e.startPos,"LEFT_OPERAND_PROBLEM")}(e,t),Pe(e,n)}function Pe(e,t){null===t&&Ve(e.startPos,"RIGHT_OPERAND_PROBLEM")}function Oe(e){return(e.startPos<<16)+e.endPos}function we(e,t){return(e<<16)+t}return{setConfiguration:function(e){},parse:function(r,a){try{e=r,t=s(r),n=t.length,o=0,i=[];var c=u();return Te()&&Ve(Ne().startPos,"MORE_INPUT",ye().toString()),c}catch(e){throw e.message}}}}().parse(e);return{eval:function(e,n){return function(e,t,n){var r,o=new h;return t||(t={}),o.push(t),r={rootContext:t,activeContext:o,locals:n},e.getValue(r)}(t,e,n)},_compiledExpression:t}},le.eval=function(e,t,n){return le.compile(e).eval(t,n)};var fe={create:function(e,t){var n={};return n.authentication=e||{},n.principal=t||{},n.hasRole=function(e){var t=!1;return!!e&&!(!n.authentication&&!Array.isArray(n.authentication.authorities))&&(n.authentication.authorities.forEach((function(n){n.authority.toLowerCase()===e.toLowerCase()&&(t=!0)})),t)},n.hasPermission=function(){var e=Array.prototype.slice.call(arguments);if(1===e.length)return n.hasRole(e[0])},n}};return t})()));